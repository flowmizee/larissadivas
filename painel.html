<!DOCTYPE html>  <html lang="pt-BR">    <head>    
  <meta charset="UTF-8" />    
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>    
  <title>Dashboard de Vendas</title>    
  <script src="https://cdn.tailwindcss.com"></script>    
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>    
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>    
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>    
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>    
  <style>    
    body {    
      font-family: 'Inter', sans-serif;    
      background-color: #f8fafc;    
    }    
    .card {    
      transition: transform 0.2s, box-shadow 0.2s;    
      background: white;    
      border-radius: 12px;    
    }    
    .card:hover {    
      transform: translateY(-4px);    
      box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1);    
    }    
    .apexcharts-tooltip {    
      background: #fff !important;    
      color: #1e293b;    
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);    
      border-radius: 8px !important;    
    }    
    .whatsapp-link {    
      color: #25D366;    
      font-weight: 500;    
    }    
    .whatsapp-link:hover {    
      text-decoration: underline;    
    }    
    .filter-input {    
      border: 1px solid #e2e8f0;    
      border-radius: 8px;    
      padding: 8px 12px;    
      transition: all 0.2s;    
    }    
    .filter-input:focus {    
      outline: none;    
      border-color: #6366f1;    
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);    
    }    
    .btn-primary {    
      background-color: #6366f1;    
      color: white;    
      border-radius: 8px;    
      padding: 8px 16px;    
      font-weight: 500;    
      transition: all 0.2s;    
    }    
    .btn-primary:hover {    
      background-color: #4f46e5;    
      transform: translateY(-1px);    
    }    
    .btn-secondary {    
      background-color: #f1f5f9;    
      color: #64748b;    
      border-radius: 8px;    
      padding: 8px 16px;    
      font-weight: 500;    
      transition: all 0.2s;    
    }    
    .btn-secondary:hover {    
      background-color: #e2e8f0;    
    }    
    @media (max-width: 768px) {    
      .responsive-grid {    
        grid-template-columns: 1fr !important;    
      }    
      .chart-container {    
        height: 300px !important;    
      }    
    }    
  </style>    
</head>    
<body>    
  <div class="min-h-screen pb-10">    
    <!-- Header -->    
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 shadow-sm">    
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex justify-between items-center">    
        <div>    
          <h1 class="text-2xl font-bold text-white">Dashboard de Vendas</h1>    
          <p class="text-indigo-100 mt-1">An√°lise completa de pedidos e clientes</p>    
        </div>    
        <button id="exportPdfBtn" class="btn-secondary flex items-center gap-2">    
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">    
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"    
              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />    
          </svg>    
          Exportar PDF    
        </button>    
      </div>    
    </div>    
    <!-- Conte√∫do Principal -->    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">    
      <!-- Filtros -->    
      <div class="card shadow p-6 mb-6">    
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Filtrar por per√≠odo</h2>    
        <div class="flex flex-wrap gap-4 items-end">    
          <div class="flex-1 min-w-[200px]">    
            <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Data inicial</label>    
            <input type="date" id="startDate" class="filter-input w-full"/>    
          </div>    
          <div class="flex-1 min-w-[200px]">    
            <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">Data final</label>    
            <input type="date" id="endDate" class="filter-input w-full"/>    
          </div>    
          <div class="flex gap-2">    
            <button id="filterBtn" class="btn-primary flex items-center gap-2">    
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">    
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"    
                  d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>    
              </svg>    
              Filtrar    
            </button>    
            <button id="resetBtn" class="btn-secondary">Limpar</button>    
          </div>    
        </div>    
      </div>  <!-- Cards de M√©tricas -->    
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6 responsive-grid">    
    <!-- Total de Vendas -->    
    <div class="card shadow p-6">    
      <div class="flex items-center justify-between">    
        <div>    
          <h3 class="text-sm font-medium text-gray-500 mb-1">Total de Vendas</h3>    
          <p id="totalSales" class="text-3xl font-semibold text-gray-800">R$ 0,00</p>    
        </div>    
        <div class="p-3 rounded-full bg-indigo-100 text-indigo-600">    
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">    
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"    
              d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />    
          </svg>    
        </div>    
      </div>    
    </div>    
    <!-- Total de Pedidos -->    
    <div class="card shadow p-6">    
      <div class="flex items-center justify-between">    
        <div>    
          <h3 class="text-sm font-medium text-gray-500 mb-1">Total de Pedidos</h3>    
          <p id="totalOrders" class="text-3xl font-semibold text-gray-800">0</p>    
        </div>    
        <div class="p-3 rounded-full bg-green-100 text-green-600">    
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">    
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"    
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />    
          </svg>    
        </div>    
      </div>    
    </div>    
    <!-- Produtos Vendidos -->    
    <div class="card shadow p-6">    
      <div class="flex items-center justify-between">    
        <div>    
          <h3 class="text-sm font-medium text-gray-500 mb-1">Produtos Vendidos</h3>    
          <p id="totalProducts" class="text-3xl font-semibold text-gray-800">0</p>    
        </div>    
        <div class="p-3 rounded-full bg-amber-100 text-amber-600">    
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">    
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"    
              d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />    
          </svg>    
        </div>    
      </div>    
    </div>    
    <!-- Ticket M√©dio -->    
    <div class="card shadow p-6">    
      <div class="flex items-center justify-between">    
        <div>    
          <h3 class="text-sm font-medium text-gray-500 mb-1">Ticket M√©dio</h3>    
          <p id="averageTicket" class="text-3xl font-semibold text-gray-800">R$ 0,00</p>    
        </div>    
        <div class="p-3 rounded-full bg-purple-100 text-purple-600">    
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">    
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"    
              d="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2zM10 8.5a.5.5 0 11-1 0 .5.5 0 011 0zm5 5a.5.5 0 11-1 0 .5.5 0 011 0z" />    
          </svg>    
        </div>    
      </div>    
    </div>    
  </div>      <!-- Produtos + Top Clientes -->      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6 responsive-grid">    
    <!-- Mais Vendidos -->    
    <div class="card shadow p-6 hidden">    
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Produtos Mais Vendidos</h2>    
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">    
        <div>    
          <h3 class="text-sm font-medium text-gray-500 mb-3">Por quantidade</h3>    
          <div id="topProductsQuantity" class="space-y-4">    
            <p class="text-gray-400 text-center py-4">Carregando dados...</p>    
          </div>    
        </div>    
        <div>    
          <h3 class="text-sm font-medium text-gray-500 mb-3">Por valor total</h3>    
          <div id="topProductsValue" class="space-y-4">    
            <p class="text-gray-400 text-center py-4">Carregando dados...</p>    
          </div>    
        </div>    
      </div>    
    </div>    
    <!-- Top Clientes -->    
    <div class="card shadow p-6">    
      <div class="flex justify-between items-center mb-4">    
        <h2 class="text-lg font-semibold text-gray-800">Top Clientes</h2>    
        <span class="text-sm text-gray-500">Por valor total</span>    
      </div>    
      <div id="topClients" class="space-y-4">    
        <p class="text-gray-400 text-center py-4">Carregando dados...</p>    
      </div>    
    </div>    
  </div>      <!-- Gr√°ficos -->      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6 responsive-grid">    
    <div class="card shadow p-6 hidden">    
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Distribui√ß√£o por Produto</h2>    
      <div id="pieChart" class="chart-container" style="height:350px;"></div>    
    </div>    
    <div class="card shadow p-6">    
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Evolu√ß√£o das Vendas</h2>    
      <div id="lineChart" class="chart-container" style="height:350px;"></div>    
    </div>    
  </div>      <!-- Tabela de Pedidos -->      <div class="card shadow overflow-hidden hidden">    
    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">    
      <h2 class="text-lg font-semibold text-gray-800">√öltimos Pedidos</h2>    
      <span id="ordersCount" class="text-sm text-gray-500">0 pedidos</span>    
    </div>    
    <div class="overflow-x-auto">    
      <table class="min-w-full divide-y divide-gray-200">    
        <thead class="bg-gray-50">    
          <tr>    
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>    
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>    
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produto</th>    
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantidade</th>    
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>    
          </tr>    
        </thead>    
        <tbody id="ordersTable" class="bg-white divide-y divide-gray-200">    
          <tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">Carregando dados...</td></tr>    
        </tbody>    
      </table>    
    </div>    
  </div>    </div>    </div>    <script>    
    // ======== UTILIT√ÅRIOS ========    
    function safeParseFloat(str) {    
      if (!str) return 0;    
      const cleaned = str.replace(/[^\d,.-]/g, '').replace(',', '.');    
      const n = parseFloat(cleaned);    
      return isNaN(n) ? 0 : n;    
    }    
    function safeParseInt(str) {    
      if (!str) return 0;    
      const cleaned = str.replace(/\D/g, '');    
      const n = parseInt(cleaned, 10);    
      return isNaN(n) ? 0 : n;    
    }    
    function formatBRL(value) {    
      return new Intl.NumberFormat('pt-BR', { style:'currency', currency:'BRL' }).format(value);    
    }    
    function formatDate(dateString) {    
      if (!dateString) return 'N/A';    
      const date = new Date(dateString);    
      if (isNaN(date)) {    
        const parts = dateString.split(' ')[0].split('/');    
        if (parts.length === 3) {    
          const d = new Date(`${parts[2]}-${parts[1]}-${parts[0]}T${dateString.split(' ')[1]||'00:00'}`);    
          if (!isNaN(d)) return d.toLocaleDateString('pt-BR');    
        }    
        return dateString;    
      }    
      return date.toLocaleDateString('pt-BR');    
    }    
    function formatWhatsAppNumber(number) {    
      if (!number) return null;    
      let digits = number.replace(/\D/g,'');    
      if (digits.startsWith('0')) digits = digits.slice(1);    
      return digits;    
    }    
    function extractProductName(fullName) {    
      if (!fullName) return '';    
      return fullName.replace(/\s*x\d+\s*-\s*R\$\s*\d+,\d+/i, '').trim();    
    }    
    function extractProductQuantity(fullName) {    
      if (!fullName) return 1;    
      const match = fullName.match(/x(\d+)/i);    
      return match ? parseInt(match[1], 10) : 1;    
    }    // ======== VARI√ÅVEIS GLOBAIS ========    
let ordersData = [];    

// ======== CARREGAR DADOS ========    
async function loadData() {    
  try {    
    const res = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vSjVHrLe1BOGqHZC9O2o1FxjWZluP8UCK6ZdcJSxcQRKIv1uJkO2NMKsrDdaTBg1fTS-XCwTq4RZzIb/pub?gid=1411128451&single=true&output=csv');    
    const csv = await res.text();    
    const lines = csv.split('\n').filter(l=>l.trim());    
    const headers = lines.shift().split(',').map(h=>h.trim());    
    ordersData = lines.map(line => {    
      const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c=>c.replace(/^"|"$/g,'').trim());    
      return headers.reduce((o,h,i)=>{ o[h] = cols[i]||''; return o; }, {});    
    });    
    processData(ordersData);    
  } catch(err) {    
    console.error(err);    
    document.getElementById('ordersTable').innerHTML = `<tr><td colspan="5" class="px-6 py-4 text-center text-red-500">Erro ao carregar dados.</td></tr>`;    
  }    
}    

// ======== PROCESSAR & EXIBIR ========    
function processData(data) {    
  document.getElementById('ordersCount').textContent = `${data.length} pedido${data.length!==1?'s':''}`;    
  const totalSales = data.reduce((s, o) => s + safeParseFloat(o['Pre√ßo Total']), 0);    
  const totalOrders = data.length;    
  const totalProducts = data.reduce((s, o) => s + safeParseInt(o['Quantidade']), 0);    
  const avgTicket = totalOrders>0 ? totalSales/totalOrders : 0;    
  document.getElementById('totalSales').textContent = formatBRL(totalSales);    
  document.getElementById('totalOrders').textContent = totalOrders.toLocaleString('pt-BR');    
  document.getElementById('totalProducts').textContent = totalProducts.toLocaleString('pt-BR');    
  document.getElementById('averageTicket').textContent = formatBRL(avgTicket);    

  // Ajuste: contar cada produto em linhas separadas    
  const byQty = {}, byVal = {}, byOccurrence = {};    
  data.forEach(o => {    
    const lines = (o['Produto'] || '').split('\n').map(l => l.trim()).filter(Boolean);    

    lines.forEach(fullName => {    
      const name = extractProductName(fullName);    
      const qty = safeParseInt(o['Quantidade']);    
      const val = safeParseFloat(o['Pre√ßo Total']);    
      const occurrenceQty = extractProductQuantity(fullName);    
      if (!name) return;    

      byQty[name] = (byQty[name]||0) + qty;    
      byVal[name] = (byVal[name]||0) + val;    
      byOccurrence[name] = (byOccurrence[name]||0) + occurrenceQty;    
    });    
  });    

  renderTopList('topProductsQuantity', byOccurrence, v => `${v} vez${v!==1?'es':''}`, false);    
  renderTopList('topProductsValue', byVal, formatBRL, true);    

  const clients = {};    
  data.forEach(o => {    
    const name = o['Nome do Cliente']||'N√£o identificado';    
    const num = o['N√∫mero do Cliente']||'';    
    const key = `${name}|${num}`;    
    clients[key] = (clients[key]||0) + safeParseFloat(o['Pre√ßo Total']);    
  });    
  renderClients('topClients', clients);    

  renderPie('pieChart', byVal);    
  renderLine('lineChart', data);    

  const last10 = data.slice().reverse().slice(0,10);    
  const tbody = document.getElementById('ordersTable');    
  if (last10.length) {    
    tbody.innerHTML = last10.map(o=>{    
      const wa = formatWhatsAppNumber(o['N√∫mero do Cliente']);    
      return `<tr class="hover:bg-gray-50">    
          <td class="px-6 py-4 text-sm text-gray-500">${formatDate(o['Data/Hora'])}</td>    
          <td class="px-6 py-4"><div class="text-sm text-gray-900">${o['Nome do Cliente']||'N/A'}</div>${    
            wa?`<a href="https://wa.me/55${wa}" target="_blank" class="whatsapp-link text-xs flex items-center gap-1">üì± ${o['N√∫mero do Cliente']}</a>`:''    
          }</td>    
          <td class="px-6 py-4 text-sm text-gray-500">${o['Produto']||'N/A'}</td>    
          <td class="px-6 py-4 text-sm text-gray-500">${o['Quantidade']||'0'}</td>    
          <td class="px-6 py-4 text-sm font-medium text-gray-900">${formatBRL(safeParseFloat(o['Pre√ßo Total']))}</td>    
        </tr>`;    
    }).join('');    
  } else {    
    tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">Nenhum pedido encontrado</td></tr>`;    
  }    
}    

// ======== AUXILIARES DE RENDER ========    
function renderTopList(containerId, mapData, fmt, showNumber) {    
  const list = Object.entries(mapData)    
    .sort((a,b)=>b[1]-a[1])    
    .slice(0, 3);    
  const cont = document.getElementById(containerId);    
  if (list.length) {    
    cont.innerHTML = list.map(([n,v],i)=>`<div class="flex items-center justify-between">    
          <div class="flex items-center"><span class="text-gray-500 font-medium w-6">${i+1}</span>    
          <span class="ml-2 font-medium text-gray-800 truncate max-w-[120px]">${n}</span></div>    
          <span class="text-gray-700">${fmt(v)}</span>    
        </div>`).join('');    
  } else {    
    cont.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum dado dispon√≠vel</p>';    
  }    
}    

function renderClients(containerId, mapData) {    
  const list = Object.entries(mapData).sort((a,b)=>b[1]-a[1]).slice(0,5);    
  const cont = document.getElementById(containerId);    
  if (list.length) {    
    cont.innerHTML = list.map(([key,val],i)=>{    
      const [n,num] = key.split('|');    
      const wa = formatWhatsAppNumber(num);    
      return `<div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">    
          <div class="flex items-center"><div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center mr-3">    
          <span class="text-indigo-600 font-medium">${i+1}</span></div><div>    
          <p class="font-medium text-gray-800">${n}</p>${    
            wa?`<a href="https://wa.me/55${wa}" target="_blank" class="whatsapp-link text-xs flex items-center gap-1">üì± ${num}</a>`:''    
          }</div></div><span class="font-medium text-gray-700">${formatBRL(val)}</span>    
        </div>`;    
    }).join('');    
  } else {    
    cont.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum cliente encontrado</p>';    
  }    
}    

function renderPie(elId, mapData) {    
  const data = Object.entries(mapData).sort((a,b)=>b[1]-a[1]).slice(0,5);    
  const opts = {    
    series: data.map(d=>d[1]),    
    chart:{ type:'pie',height:350,animations:{enabled:true} },    
    labels: data.map(d=>d[0]),    
    colors:['#6366F1','#8B5CF6','#EC4899','#F43F5E','#F59E0B','#10B981','#14B8A6','#0EA5E9','#3B82F6','#64748B'],    
    legend:{ position:'bottom', fontFamily:'Inter, sans-serif', labels:{colors:'#6b7280'} },    
    tooltip:{ y:{formatter:v=>formatBRL(v)} },    
    responsive:[{ breakpoint:480, options:{ chart:{width:200}, legend:{position:'bottom'} } }]    
  };    
  const el = document.querySelector(`#${elId}`); el.innerHTML='';    
  if(window._pie) window._pie.destroy();    
  window._pie=new ApexCharts(el,opts); window._pie.render();    
}    

function renderLine(elId,data) {    
  const byDate={};    
  data.forEach(o=>{    
    let d=o['Data/Hora']; if(!d)return;    
    let dt=d.includes('/')? new Date(d.split(' ')[0].split('/').reverse().join('-')+'T'+(d.split(' ')[1]||'00:00')):new Date(d);    
    if(isNaN(dt))return;    
    const day=dt.toISOString().split('T')[0];    
    byDate[day]=(byDate[day]||0)+safeParseFloat(o['Pre√ßo Total']);    
  });    
  const dates=Object.keys(byDate).sort();    
  const series=[{name:'Vendas',data:dates.map(d=>({x:d,y:byDate[d]}))}];    
  const opts={ series, chart:{type:'line',height:350,zoom:{enabled:false},toolbar:{show:false}},    
    stroke:{curve:'smooth',width:3},    
    xaxis:{type:'datetime',labels:{formatter:v=>new Date(v).toLocaleDateString('pt-BR'),style:{fontFamily:'Inter, sans-serif'}}},    
    yaxis:{labels:{formatter:v=>formatBRL(v),style:{fontFamily:'Inter, sans-serif'}}},    
    tooltip:{x:{formatter:v=>new Date(v).toLocaleDateString('pt-BR')},y:{formatter:v=>formatBRL(v)},style:{fontFamily:'Inter, sans-serif'}},    
    grid:{borderColor:'#f1f5f9'}, colors:['#6366F1']    
  };    
  const el=document.querySelector(`#${elId}`); if(window._line)window._line.destroy();    
  window._line=new ApexCharts(el,opts); window._line.render();    
}    

function filterByDate(s,e){    
  const start=s?new Date(s):null, end=e?new Date(e):null;    
  if(start)start.setHours(0,0,0,0); if(end)end.setHours(23,59,59,999);    
  return ordersData.filter(o=>{    
    let d=o['Data/Hora']; if(!d)return false;    
    let dt=d.includes('/')? new Date(d.split(' ')[0].split('/').reverse().join('-')+'T'+(d.split(' ')[1]||'00:00')):new Date(d);    
    if(isNaN(dt))return false;    
    if(start&&dt<start) return false;    
    if(end&&dt>end) return false;    
    return true;    
  });    
}    

async function exportToPDF(){    
  const {jsPDF}=window.jspdf; const doc=new jsPDF({orientation:'portrait',unit:'mm'});    
  const today=new Date().toLocaleDateString('pt-BR');    
  doc.setFontSize(20).text('Relat√≥rio de Vendas',105,20,{align:'center'});    
  doc.setFontSize(12).text(`Data do relat√≥rio: ${today}`,105,28,{align:'center'});    
  doc.setFontSize(14).text('Resumo Geral',20,40);    
  doc.setFontSize(12);    
  doc.text(`Total de Vendas: ${document.getElementById('totalSales').textContent}`,20,48);    
  doc.text(`Total de Pedidos: ${document.getElementById('totalOrders').textContent}`,20,56);    
  doc.text(`Produtos Vendidos: ${document.getElementById('totalProducts').textContent}`,20,64);    
  doc.text(`Ticket M√©dio: ${document.getElementById('averageTicket').textContent}`,20,72);    
  doc.save(`relatorio_vendas_${today.replace(/\//g,'-')}.pdf`);    
}    

document.getElementById('filterBtn').addEventListener('click',()=>{    
  const s=document.getElementById('startDate').value, e=document.getElementById('endDate').value;    
  processData(filterByDate(s,e));    
});    
document.getElementById('resetBtn').addEventListener('click',()=>{      
  document.getElementById('startDate').value=''; document.getElementById('endDate').value='';    
  processData(ordersData);    
});    
document.getElementById('exportPdfBtn').addEventListener('click',exportToPDF);    
document.addEventListener('DOMContentLoaded',loadData);

</script>  </body>

</html>     
